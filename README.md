# SmoQyDQMC

[![Stable](https://img.shields.io/badge/docs-stable-blue.svg)](https://SmoQySuite.github.io/SmoQyDQMC.jl/stable/)
[![Dev](https://img.shields.io/badge/docs-dev-blue.svg)](https://SmoQySuite.github.io/SmoQyDQMC.jl/dev/)
[![Build Status](https://github.com/SmoQySuite/SmoQyDQMC.jl/actions/workflows/CI.yml/badge.svg?branch=main)](https://github.com/SmoQySuite/SmoQyDQMC.jl/actions/workflows/CI.yml?query=branch%3Amain)
[![Coverage](https://codecov.io/gh/SmoQySuite/SmoQyDQMC.jl/branch/main/graph/badge.svg)](https://codecov.io/gh/SmoQySuite/SmoQyDQMC.jl)
![](https://img.shields.io/badge/Lifecycle-Maturing-007EC6g)

This package implements the determinant quantum Monte Carlo (DQMC) method for Hubbard,
and electron-phonon interactions, including both Holstein and Su-Schrieffer-Heeger (SSH) style
electron-phonon coupling.

## Diff From Main Repository

This fork aims to tackle the sometimes large amounts of file I/O generated by this package. Our research group was unfortunately crashing our HPC due to large numbers of files, so this is our solution.

Using the `LessIO` flag in `write_measurements!()` in addition to the extra kwarg `measurement_array`, we can suppress the writing data to bin files and instead store and read it from memory in the measurements array. LessIO also removes the need for generating `model_summary.toml`, which saves an extra write and a few reads for each run. 

The only necessity for this is creating an array ahead of time to store these values in, using `measurement_array = Vector{NamedTuple}(undef, N_bins)` and creating a variable `LessIO::Bool = true`

Then we can pass these to `write_measurements!()`

``write_measurements!(LessIO; measurement_container = measurement_container, measurement_array = measurement_array, simulation_info = simulation_info, model_geometry = model_geometry, bin = bin, bin_size = bin_size, Δτ = Δτ,)``

And finally pass `measurement_array` to `process_measurements()`

`process_measurements(simulation_info.datafolder, N_bins, β, Lτ, model_geometry, measurement_array)`

Currently, this supports global and local statistics, with functionality for correlations coming in the future. All LessIO related functions are called using Julia's multiple dispatch, so the original functions are left untouched. This means that all examples and typical SmoQy code should run as normal. Note that MPI is currently not compatible with this LessIO.

**Also, it is important to note that this is still in testing, so there is chance that results may be inaccurate in some cases.**
**We have so far seen exact matching of results for U=0 runs of the Fermi-Hubbard model on the Kagome Lattice, however there are many other untested cases.**

### To Do

- Add support for correlation functions in LessIO
- Add support for `LessIO::Bool = false` to revert back to standard file-write method, instead of having to remove the arguments. Will just need to modify `write_measurements!()` and `process_measurements()` slightly for this.
- Remove excess directory creation for LessIO mode, saving all .CSV files into `simulation_info.datafolder` rather than subdirectories
- Add MPI support eventually?
- Benchmarking runtimes for LessIO vs. standard method
- Add example codes using LessIO
- Update documentation to reflect LessIO

## Funding

The development of this code was supported by the U.S. Department of Energy, Office of Science, Basic Energy Sciences,
under Award Number DE-SC0022311.

## Installation

To install the [SmoQyDQMC.jl](https://github.com/SmoQySuite/SmoQyDQMC.jl),
simply open the Julia REPL and run the command
```julia
julia> ]
pkg> add SmoQyDQMC
```
or equivalently via `Pkg` do
```julia
julia> using Pkg; Pkg.add("SmoQyDQMC")
```

## Documentation

- [`STABLE`](https://SmoQySuite.github.io/SmoQyDQMC.jl/stable/): Documentation for the latest version of the code published to the Julia [General](https://github.com/JuliaRegistries/General.git) registry.
- [`DEV`](https://SmoQySuite.github.io/SmoQyDQMC.jl/dev/): Documentation associated with most recent commit to the main branch.

## Publication List

Follow this [link](https://smoqysuite.github.io/SmoQyDQMC.jl/dev/#Publication-List)
to see a list of some of the publications that report results generated using
the [SmoQyDQMC.jl](https://github.com/SmoQySuite/SmoQyDQMC.jl) package.

## Notable Package Dependencies

This section reviews some notable package dependencies.

### Re-exported Packages

The [SmoQyDQMC.jl](https://github.com/SmoQySuite/SmoQyDQMC.jl) re-exports certain packages using
the [Reexport.jl](https://github.com/simonster/Reexport.jl.git) package in order to simplify the installation process.

- [LatticeUtilties.jl](https://github.com/SmoQySuite/LatticeUtilities.jl.git): Used to represent arbitrary lattice geometries.
- [JDQMCFramework.jl](https://github.com/SmoQySuite/JDQMCFramework.jl.git): Implements and exports the basic framework for running a DQMC simulation.
- [JDQMCMeasurements.jl](https://github.com/SmoQySuite/JDQMCMeasurements.jl.git): Implements various global, local and correlation measurements for a DQMC simulation.
- [MuTuner.jl](https://github.com/cohensbw/MuTuner.jl.git): Impelments and exports an algorithm for tuning the chemical potential to achieve a target density in grand canonical Monte Carlo simulations.

### External Dependencies

- [StableLinearAlgebra.jl](https://github.com/SmoQySuite/StableLinearAlgebra.jl.git): Implements optimized numerical stabilizaiton methods required by DQMC simulations.
- [Checkerboard.jl](https://github.com/SmoQySuite/Checkerboard.jl.git): Implements and exports the checkerboard method for approximating exponentiated hopping matrices by a sparse matrix.
- [JLD2.jl](https://github.com/JuliaIO/JLD2.jl.git): Package used to write data to binary files in an HDF5 compatible format. It is also recommended this package be used at the scripting level to implement checkpointing in a simulation.

## Citation

If you found this library to be useful in the course of academic work, please consider citing us:

```bibtex
@Article{SmoQyDQMC.jl,
 title={{SmoQyDQMC.jl: A flexible implementation of determinant quantum Monte Carlo for Hubbard and electron-phonon interactions}},
 author={Benjamin Cohen-Stead and Sohan Malkaruge Costa and James Neuhaus and Andy Tanjaroon Ly and Yutan Zhang and Richard Scalettar and Kipton Barros and Steven Johnston},
 journal={SciPost Phys. Codebases},
 pages={29},
 year={2024},
 publisher={SciPost},
 doi={10.21468/SciPostPhysCodeb.29},
 url={https://scipost.org/10.21468/SciPostPhysCodeb.29},
 title={{SmoQyDQMC.jl: A flexible implementation of determinant quantum Monte Carlo for Hubbard and electron-phonon interactions}},
 author={Benjamin Cohen-Stead and Sohan Malkaruge Costa and James Neuhaus and Andy Tanjaroon Ly and Yutan Zhang and Richard Scalettar and Kipton Barros and Steven Johnston},
 journal={SciPost Phys. Codebases},
 pages={29},
 year={2024},
 publisher={SciPost},
 doi={10.21468/SciPostPhysCodeb.29},
 url={https://scipost.org/10.21468/SciPostPhysCodeb.29},
}
```

## Publications

A list of some of the publications that report results generated using [SmoQyDQMC.jl](https://github.com/SmoQySuite/SmoQyDQMC.jl)
can be found [here](https://smoqysuite.github.io/SmoQyDQMC.jl/stable/#Publication-List).

## Contact Us

For question and comments regarding this package, please email either Dr. Benjamin Cohen-Stead at [bcohenst@utk.edu](mailto:bcohenst@utk.edu) or Professor Steven Johnston at [sjohn145@utk.edu](mailto:sjohn145@utk.edu).